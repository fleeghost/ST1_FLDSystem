<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>福路德-主页</title>
    <link rel="stylesheet" type="text/css" href="assets/element-ui/theme-chalk/index.css" />
    <link rel="stylesheet" type="text/css" href="assets/ionicons/css/ionicons.css" />
    <link rel="stylesheet" type="text/css" href="assets/base.css" />
    <script type="text/javascript" src="assets/jquery/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="assets/layer/layer.js"></script>
    <script type="text/javascript" src="assets/vue.js"></script>
    <script type="text/javascript" src="assets/element-ui/index.js"></script>
    <script type="text/javascript" src="assets/vue-element-bigdata-table.min.js"></script>
    <style>
        .el-container {
            height: 100%;
            font-size: 12px;
        }

        .el-container .el-header {
            height: auto !important;
            padding: 0 !important;

        }

        .el-container .el-header .row-1 {
            background: #b91727;
            padding: 0 20px;
            overflow: hidden;
            color: #fff;
            -webkit-app-region: drag;
        }

        .el-container .el-header .row-1 .logo {
            float: left;
            font-size: 16px;
            font-weight: 700;
            padding: 5px 0;
        }

        .el-container .el-header .row-1 .logo img,
        .el-container .el-header .row-1 .logo span {
            vertical-align: middle;
        }

        .el-container .el-header .row-1 .system-operation {
            float: right;
            height: 40px;
            line-height: 40px;
            overflow: hidden;
            font-size: 20px;
            -webkit-app-region: no-drag;
        }

        .el-container .el-header .row-1 .system-operation>div {
            cursor: pointer;
            vertical-align: top;
            height: 40px;
            padding: 0 8px;
            float: left;
        }

        .el-container .el-header .row-1 .system-operation>div:hover {
            background: rgba(255, 255, 255, .2);
        }

        .el-container .el-header .row-1 .system-operation .img img {
            width: 30px;
            height: 30px;
            border-radius: 15px;
            margin-top: 5px;
        }

        .el-container .el-header .row-2 {
            background: #1e2226;
            color: #fff;
            position: relative;
            overflow: hidden;
        }

        /* .el-container .el-header .row-2 .tabs-padding{
            padding-right:160px;
        } */
        /* .el-container .el-header .row-2 .calendar{
            position: absolute;
            width: 160px;
            right: 0;
            top: 0;
            height: 100%;
            background: #fff;
        } */
        .el-container .el-header .el-tabs--border-card {
            background: transparent;
            border: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
        }



        .el-container .el-header .el-tabs--border-card>.el-tabs__header .el-tabs__item:not(.is-disabled):hover {
            background: #404346;
            border-right-color: #404346;
            border-left-color: #404346;
            color: #fff;
        }

        .el-container .el-header .el-tabs--border-card>.el-tabs__header .el-tabs__item.is-active {
            background: #404346;
            border-right-color: #404346;
            border-left-color: #404346;
            color: #fff;
        }

        .el-container .el-header .el-tabs__content {
            display: none
        }

        .el-container .el-aside {
            background: #1e2226;
            width: auto !important;
        }

        .el-container .el-aside .tree-search {
            padding: 5px 10px 5px 20px;
            height: 38px;
            font-size: 13px;
        }

        .el-container .el-aside .tree-search button {
            min-width: 24px;
            text-align: center;
        }

        .el-container .el-aside .tree-search .el-button--text {
            color: #b9b4b4;
        }

        .el-container .el-aside .tree-search .search-text {
            display: inline-block;
            height: 28px;
            line-height: 28px;
            margin-left: 10px;
        }

        .el-container .el-aside .tree-search .search-text input {
            border: 1px solid #525558;
            margin: 0;
            padding: 0 10px 0;
            width: 80px;
            height: 22px;
            border-radius: 11px;
            background: #35393c;
            outline: none;
            color: #fff;
        }

        .el-container .el-aside .tree-search .el-input-group__append {
            padding: 0 5px;
            cursor: pointer;
        }

        .el-container .el-aside .tree-list {
            height: calc(100% - 38px);
            overflow-y: auto;
        }

        .bg-opacity {
            background: rgba(255, 255, 255, .03);
        }

        .el-menu--vertical {
            background: rgba(30, 34, 38, .97);
        }

        .el-menu {
            border: 0;
        }

        .el-submenu__title {
            height: 36px;
            line-height: 36px;
            font-size: 13px;
        }

        .el-menu-item {
            height: 36px;
            line-height: 36px;
            font-size: 13px;
        }

        .el-submenu .el-menu-item {
            height: 36px;
            line-height: 36px;
        }

        .el-menu--popup {
            padding: 0;
            margin: 0;
        }

        .el-submenu [class^=el-icon-] {
            font-size: 16px;
        }

        .el-menu-item [class^=el-icon-] {
            font-size: 16px;
        }

        .el-submenu__title:focus,
        .el-submenu__title:hover,
        .el-menu-item:focus,
        .el-menu-item:hover {
            background-color: rgba(116, 14, 24, .3) !important;
        }

        .el-menu-item.is-active {
            background-color: rgba(116, 14, 24, .3) !important;
        }

        .el-menu-vertical-demo:not(.el-menu--collapse) {
            width: 240px;
            min-height: 400px;
        }

        .el-container .el-main {
            padding: 0;
            position: relative;
        }

        .el-container .el-main .tabs {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
        }

        .el-container .el-main .el-tabs--border-card {
            background: transparent;
            border: 0;
            height: 100%;
        }

        .el-container .el-main .el-tabs--border-card>.el-tabs__header {
            background: #fff;
            padding-top: 0;
        }

        .el-container .el-main .el-tabs--border-card>.el-tabs__header .el-tabs__item:not(.is-disabled):hover {
            background: #acb0b3;
            border-right-color: #acb0b3;
            border-left-color: #acb0b3;
            color: #fff;
        }

        .el-container .el-main .el-tabs--border-card>.el-tabs__header .el-tabs__item.is-active {
            background: #acb0b3;
            border-right-color: #acb0b3;
            border-left-color: #acb0b3;
            color: #fff;
        }



        .el-container .el-main .el-tabs__content {
            height: calc(100% - 29px);
            padding: 0;
            background: #e7eded;
        }

        .el-container .el-main .frame {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 100%;
            overflow: hidden;
        }

        .el-container .el-footer {
            height: 26px !important;
            line-height: 26px;
            text-align: center;
            background: #000000;
            color: #808080;
        }
    </style>
</head>

<body>
    <div id="app">
        <el-container v-cloak>
            <el-header>
                <div class="row-1">
                    <div class="logo">
                        <img src="image/logo.png" />
                        <span>福路德信息化平台</span>
                    </div>
                    <div class="system-operation">
                        <div>
                            <i class="el-icon-bell"></i>
                        </div>
                        <div style="font-size:12px;">
                            <span>金俊杰</span>
                            <i class="el-icon-arrow-down"></i>
                        </div>
                        <div class="img">
                            <img src="image/header.png" />
                        </div>
                        <div style="font-size:12px;" @click="min">
                            <i class="el-icon-minus"></i>
                        </div>
                        <div style="font-size:12px;" @click="close">
                            <span>退出</span>
                        </div>
                    </div>
                </div>
                <div class="row-2">
                    <el-tabs class="tabs-padding" type="border-card" v-model="categoryActive"
                        @tab-click="categoryToggle">
                        <el-tab-pane v-for="(row,index) in categoryList" :label="row.Name"
                            :name="row.Id + '_' + row.Name"></el-tab-pane>
                    </el-tabs>
                    <!-- <div class="calendar"></div> -->
                </div>
            </el-header>
            <el-container>
                <el-aside>
                    <div class="tree-search">
                        <el-button type="text" icon="el-icon-menu" @click="toggleTree()"></el-button>
                        <el-button type="text" icon="el-icon-d-caret" v-show="showIcon">伸缩</el-button>
                        <div class="search-text" v-show="showIcon">
                            <!-- <el-input placeholder="请输入内容">
                                <template slot="append"><i class="el-icon-search"></i></template>
                            </el-input> -->
                            <input type="text" />
                            <el-button type="text" icon="el-icon-search"></el-button>
                        </div>
                    </div>
                    <div class="tree-list">
                        <el-menu background-color="transparent" text-color="#fff" active-text-color="#fff"
                            :collapse="isCollapse" class="el-menu-vertical-demo">
                            <!-- <el-submenu index='1'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>用户管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-menu-item index="1-1">用户信息管理</el-menu-item>
                                    <el-menu-item index="1-2">公司及部门组织架构管理</el-menu-item>
                                </div>
                            </el-submenu>
                            <el-submenu index='2'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>基础数据管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-menu-item index="2-1">角色管理</el-menu-item>
                                    <el-menu-item index="2-2">角色及权限分配</el-menu-item>
                                </div>
                            </el-submenu>
                            <el-submenu index='3'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>权限管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-submenu index="3-1">
                                        <template slot="title">商品类</template>
                                        <el-menu-item index="3-1-1">商品档案</el-menu-item>
                                        <el-menu-item index="3-1-2">商品类别</el-menu-item>
                                        <el-menu-item index="3-1-3">商品计量单位</el-menu-item>
                                        <el-menu-item index="3-1-4">价格单位</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="3-2">
                                        <template slot="title">客户类</template>
                                        <el-menu-item index="3-2-1">客户档案</el-menu-item>
                                        <el-menu-item index="3-2-2">供货商档案</el-menu-item>
                                        <el-menu-item index="3-2-3">分公司档案</el-menu-item>
                                        <el-menu-item index="3-2-4">地区档案</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="3-3">
                                        <template slot="title">仓库类</template>
                                        <el-menu-item index="3-3-1">存货仓库</el-menu-item>
                                        <el-menu-item index="3-3-2">货位档案</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="3-4">
                                        <template slot="title">金额类</template>
                                        <el-menu-item index="3-4-1">信用额度管理</el-menu-item>
                                        <el-menu-item index="3-4-2">货币管理</el-menu-item>
                                    </el-submenu>
                                </div>
                            </el-submenu>
                            <el-submenu index='4'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>销售管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-submenu index="4-1">
                                        <template slot="title">价格策略</template>
                                        <el-menu-item index="4-1-1">基础价格策略</el-menu-item>
                                        <el-menu-item index="4-1-2">促销策略</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="4-2">
                                        <template slot="title">订单管理</template>
                                        <el-menu-item index="4-2-1">销售订单</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="4-3">
                                        <template slot="title">出货管理</template>
                                        <el-menu-item index="4-3-1">销售出货单</el-menu-item>
                                        <el-menu-item index="4-3-2">销售退货单</el-menu-item>
                                        <el-menu-item index="4-3-3">销售换货单</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="4-4">
                                        <template slot="title">委托代销</template>
                                        <el-menu-item index="4-4-1">委托代销发货</el-menu-item>
                                        <el-menu-item index="4-4-2">委托代销退货</el-menu-item>
                                        <el-menu-item index="4-4-3">委托代销结算</el-menu-item>
                                        <el-menu-item index="4-4-4">委托代销调价</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="4-5">
                                        <template slot="title">报表</template>
                                        <el-menu-item index="4-5-1">...</el-menu-item>
                                    </el-submenu>
                                </div>
                            </el-submenu>
                            <el-submenu index='5'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>采购管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-submenu index="5-1">
                                        <template slot="title">请购管理</template>
                                        <el-menu-item index="5-1-1">请购单</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="5-2">
                                        <template slot="title">订单管理</template>
                                        <el-menu-item index="5-2-1">采购订单</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="5-3">
                                        <template slot="title">收货管理</template>
                                        <el-menu-item index="5-3-1">采购入库单</el-menu-item>
                                        <el-menu-item index="5-3-2">采购退库单</el-menu-item>
                                        <el-menu-item index="5-3-3">采购换库单</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="5-4">
                                        <template slot="title">受托代销</template>
                                        <el-menu-item index="5-4-1">受托代销收货</el-menu-item>
                                        <el-menu-item index="5-4-2">受托代销退货</el-menu-item>
                                        <el-menu-item index="5-4-3">受托代销结算</el-menu-item>
                                        <el-menu-item index="5-4-4">受托代销调价</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="5-5">
                                        <template slot="title">报表</template>
                                        <el-menu-item index="5-5-1">...</el-menu-item>
                                    </el-submenu>
                                </div>
                            </el-submenu>
                            <el-submenu index='6'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>仓库运输管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-menu-item index="6-1">条码管理</el-menu-item>
                                    <el-submenu index="6-2">
                                        <template slot="title">调拨管理</template>
                                        <el-menu-item index="6-2-1">同价/变价调拨单</el-menu-item>
                                        <el-menu-item index="6-2-2">分支机构调拨单</el-menu-item>
                                        <el-menu-item index="6-2-3">调拨单查询</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="6-3">
                                        <template slot="title">盘点管理</template>
                                        <el-menu-item index="6-3-1">库存盘点</el-menu-item>
                                        <el-menu-item index="6-3-2">库存预警设置</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="6-4">
                                        <template slot="title">报表</template>
                                        <el-menu-item index="6-4-1">...</el-menu-item>
                                    </el-submenu>
                                </div>
                            </el-submenu>
                            <el-submenu index='7'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>往来管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-submenu index="7-1">
                                        <template slot="title">发票管理</template>
                                        <el-menu-item index="7-1-1">销售发票</el-menu-item>
                                        <el-menu-item index="7-1-2">采购发票</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="7-2">
                                        <template slot="title">往来处理</template>
                                        <el-menu-item index="7-2-1">往来对账</el-menu-item>
                                        <el-menu-item index="7-2-2">预收预付</el-menu-item>
                                        <el-menu-item index="7-2-3">应收应付</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="7-3">
                                        <template slot="title">报表</template>
                                        <el-menu-item index="7-3-1">...</el-menu-item>
                                    </el-submenu>
                                </div>
                            </el-submenu>
                            <el-submenu index='8'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>成品费用管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-submenu index="8-1">
                                        <template slot="title">现金费用</template>
                                        <el-menu-item index="8-1-1">费用单</el-menu-item>
                                        <el-menu-item index="8-1-2">转款单</el-menu-item>
                                        <el-menu-item index="8-1-3">其他收入单</el-menu-item>
                                    </el-submenu>
                                    <el-menu-item index="8-2">固定资产</el-menu-item>
                                    <el-submenu index="8-3">
                                        <template slot="title">提成管理</template>
                                        <el-menu-item index="8-3-1">业务分配</el-menu-item>
                                        <el-menu-item index="8-3-2">业务提成</el-menu-item>
                                    </el-submenu>
                                    <el-submenu index="8-4">
                                        <template slot="title">报表</template>
                                        <el-menu-item index="8-4-1">...</el-menu-item>
                                    </el-submenu>
                                </div>
                            </el-submenu>
                            <el-submenu index='9'>
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>会员管理</span>
                                </template>
                                <div class="bg-opacity">
                                    <el-submenu index="9-1">
                                        <template slot="title">会员管理</template>
                                        <el-menu-item index="9-1-1">信息管理</el-menu-item>
                                        <el-menu-item index="9-1-2">积分管理</el-menu-item>
                                    </el-submenu>
                                </div>
                            </el-submenu> -->

                            <menu-template :menu_data="nodeList" @item-click="treeSelect"></menu-template>

                        </el-menu>
                    </div>
                </el-aside>
                <el-container>
                    <el-main>
                        <div class="tabs">
                            <el-tabs type="border-card" v-model="rightTabsActive" @tab-remove="rightTabsRemove">
                                <el-tab-pane label="首页" name="首页">
                                    <div class="frame">
                                        <webview src="http://47.110.58.236:9981/TreeFormList/Table?moduleName=仓库树列表"
                                            style="width:100%;height:100%"></webview>
                                    </div>
                                </el-tab-pane>
                                <el-tab-pane closable v-for="(row,index) in rightTabsList" :label="row.Name"
                                    :name="row.Id + '_' + row.Name">
                                    <div class="frame">
                                        <webview :src="row.NavigateUrl" style="width:100%;height:100%"></webview>
                                    </div>
                                </el-tab-pane>
                            </el-tabs>
                        </div>
                    </el-main>
                    <el-footer>福路德</el-footer>
                </el-container>
            </el-container>
        </el-container>
    </div>
</body>
<script>
    const { ipcRenderer } = require('electron')
    const { SystemModules, SelfModules } = require(ipcRenderer.sendSync('getRootPath') + '/assembly/RequireHelper')
    const { post } = SelfModules('httpHelper')

    Vue.prototype.$ELEMENT = { size: 'mini' }

    Vue.component('menu-template-sub', {
        props: ['menu_data'],
        template: '<div>' +
            '<div v-for="(row,index) in menu_data">' +
            '<el-submenu v-if="row.node.length" :index="\'self\' + row.Id">' +
            '<template slot="title">{{row.Name}}</template>' +
            '<menu-template-sub :menu_data="row.node" @sub-item-click="menuItemClick"></menu-template-sub>' +
            '</el-submenu>' +
            '<el-menu-item v-else :index="\'self\' + row.Id" @click="menuItemClick(row)">{{row.Name}}</el-menu-item>' +
            '</div>' +
            '</div>',
        methods: {
            menuItemClick(row) {
                this.$emit('sub-item-click', row);
            }
        }

    })
    Vue.component('menu-template', {
        props: ['menu_data'],
        template: '<div>' +
            '<div v-for="(row,index) in menu_data">' +
            '<el-submenu v-if="row.node.length" :index="\'self\' + row.Id">' +
            '<template slot="title">{{row.Name}}</template>' +
            '<menu-template-sub :menu_data="row.node" class="bg-opacity" @sub-item-click="menuItemClick" ></menu-template-sub>' +
            '</el-submenu>' +
            '<el-menu-item v-else :index="\'self\' + row.Id" @click="menuItemClick(row)">{{row.Name}}</el-menu-item>' +
            '</div>' +
            '</div>',
        methods: {
            menuItemClick(row) {
                this.$emit('item-click', row);
            }
        }

    })
    const vm = new Vue({
        el: '#app',
        data: {
            showIcon: true,
            isCollapse: false,
            totalList: [],
            categoryList: [],
            categoryActive: '',
            nodeList: [],
            rightTabsList: [],
            rightTabsActive: '首页'
        },
        created: function () {
            var that = this;

            post({
                path: '/Frame/SqlData'
            }, {
                    cmdname: 'getMainMenu'
                }, (ret) => {
                    let data = JSON.parse(ret);
                    if (data.status == 200) {
                        let that = this;
                        that.totalList = data.data.ds;
                        for (let i in that.totalList) {
                            if (that.totalList[i].ParentID == 0) {
                                that.categoryList.push(that.totalList[i]);
                            }
                        }
                        if (that.categoryList.length > 0) {
                            that.categoryActive = that.categoryList[0].Id + '_' + that.categoryList[0].Name
                            that.setSubClass(that.categoryList[0].Id);
                        }


                    } else {
                        layer.msg('接口数据异常!请稍后再试');
                    }
                }, (err) => {

                })

        },
        methods: {
            setSubClass(id) {
                let that = this;
                that.nodeList = [];
                let repeatNode = (id) => {
                    let node = [];
                    for (let i in that.totalList) {
                        if (id == that.totalList[i].ParentID) {
                            that.totalList[i].node = repeatNode(that.totalList[i].Id);
                            node.push(that.totalList[i]);
                        }
                    }
                    return node;
                }
                that.nodeList = repeatNode(id);
            },
            treeSelect(row) {
                let that = this;
                let x = 0;
                for (let i in that.rightTabsList) {
                    if (that.rightTabsList[i].Id == row.Id) {
                        x = 1;
                        that.rightTabsActive = row.Id + '_' + row.Name;
                    }
                }
                if (x == 0) {
                    that.rightTabsList.push(row);
                    that.rightTabsActive = row.Id + '_' + row.Name;
                }
            },
            rightTabsRemove(targetName) {
                let tabs = this.rightTabsList;
                let activeName = this.rightTabsActive;
                if (activeName === targetName) {
                    tabs.forEach((tab, index) => {
                        if ((tab.Id + '_' + tab.Name) === targetName) {
                            let nextTab = tabs[index + 1] || tabs[index - 1];
                            if (nextTab) {
                                activeName = nextTab.name;
                            }else{
                                activeName = '首页'
                            }
                        }
                    });
                }

                this.rightTabsActive = activeName;
                this.rightTabsList = tabs.filter(tab => (tab.Id + '_' + tab.Name) !== targetName);
            },
            //大类切换
            categoryToggle(e) {
                var that = this;
                let name = e.name;
                let id = parseInt(name.split('_')[0]);
                that.setSubClass(id)
            },
            min() {
                ipcRenderer.send('minWindow');
            },
            close() {
                layer.confirm('确定退出吗?', {
                    btn: ['确认', '取消'] //按钮
                }, () => {
                    ipcRenderer.sendSync('quitApp');
                }, () => {
                    layer.closeAll()
                });

            },
            toggleTree() {
                let that = this;
                that.showIcon = !that.showIcon;
                setTimeout(() => {
                    that.isCollapse = !that.showIcon;
                }, 100)
            }
        }
    })
</script>

</html>