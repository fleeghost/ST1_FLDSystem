<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>福路德信息化平台</title>
    <link rel="stylesheet" type="text/css" href="assets/element-ui/theme-chalk/index.css" />
    <link rel="stylesheet" type="text/css" href="assets/ionicons/css/ionicons.css" />
    <link rel="stylesheet" type="text/css" href="assets/base.css" />
    <link rel="stylesheet" type="text/css" href="assets/plugins/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="assets/iconfont/iconfont.css" />
    <script type="text/javascript" src="assets/jquery/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="assets/layer/layer.js"></script>
    <script type="text/javascript" src="assets/vue.js"></script>
    <script type="text/javascript" src="assets/element-ui/index.js"></script>
    <script type="text/javascript" src="assets/vue-element-bigdata-table.min.js"></script>
    <style>
        .el-container {
            height: 100%;
            font-size: 12px;
        }

        .el-container .el-header {
            height: auto !important;
            padding: 0 !important;

        }

        .el-container .el-header .row-1 {
            background: #b91727;
            padding: 0 0 0 20px;
            overflow: hidden;
            color: #fff;
            -webkit-app-region: drag;
        }

        .el-container .el-header .row-1 .logo {
            float: left;
            font-size: 16px;
            font-weight: 700;
            padding: 5px 0;
        }

        .el-container .el-header .row-1 .logo img,
        .el-container .el-header .row-1 .logo span {
            vertical-align: middle;
        }

        .el-container .el-header .row-1 .system-operation {
            float: right;
            height: 40px;
            line-height: 40px;
            overflow: hidden;
            font-size: 20px;
            -webkit-app-region: no-drag;
        }

        .el-container .el-header .row-1 .system-operation .item {
            cursor: pointer;
            vertical-align: top;
            height: 40px;
            padding: 0 8px;
            float: left;
            font-size: 12px;
        }

        .el-container .el-header .row-1 .system-operation .item:hover {
            background: rgba(255, 255, 255, .2);
        }

        .el-container .el-header .row-1 .system-operation .img img {
            width: 30px;
            height: 30px;
            border-radius: 15px;
            margin-top: 5px;
        }

        .el-container .el-header .row-2 {
            background: #1e2226;
            color: #fff;
            position: relative;
            overflow: hidden;
        }

        .el-container .el-header .row-3 {
            background: #e5e5e5;
            color: #000;
            position: relative;
            overflow: hidden;
        }

        .el-container .el-header .el-tabs--border-card {
            background: transparent;
            border: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
        }

        .el-container .el-header .el-tabs--border-card>.el-tabs__header .el-tabs__item:not(.is-disabled):hover {
            background: #404346;
            border-right-color: #404346;
            border-left-color: #404346;
            color: #fff;
        }

        .el-container .el-header .el-tabs--border-card>.el-tabs__header .el-tabs__item.is-active {
            background: #404346;
            border-right-color: #404346;
            border-left-color: #404346;
            color: #fff;
            margin-top: 0;
        }

        .el-container .el-header .el-tabs__content {
            display: none
        }

        .el-container .tree-search {
            font-size: 13px;
        }

        .el-container .tree-search button {
            min-width: 24px;
            text-align: center;
        }

        .el-container .tree-search .el-button--text {
            color: #606266;
        }

        .el-container .tree-search .search-text {
            display: inline-block;
            height: 28px;
            line-height: 28px;
            margin-left: 10px;
        }

        .el-container .tree-search .search-text input {
            border: 1px solid #c7c7c7;
            margin: 0;
            padding: 0 10px 0;
            width: 117px;
            height: 22px;
            border-radius: 11px;
            background: #c7c7c7;
            outline: none;
            color: #606266;
        }

        .el-container .tree-search .el-input-group__append {
            padding: 0 5px;
            cursor: pointer;
        }

        .el-container .el-aside {
            background: #1e2226;
            width: auto !important;
        }



        .el-container .el-aside .tree-list {
            height: 100%;
            overflow-y: auto;
        }

        .bg-opacity {
            background: rgba(255, 255, 255, .03);
        }

        .el-menu--vertical {
            background: rgba(30, 34, 38, .97);
        }

        .el-menu {
            border: 0;
        }

        .el-submenu__title {
            height: 36px;
            line-height: 36px;
            font-size: 13px;
        }

        .el-menu-item {
            height: 36px;
            line-height: 36px;
            font-size: 13px;
        }

        .el-submenu .el-menu-item {
            height: 36px;
            line-height: 36px;
        }

        .el-menu--popup {
            padding: 0;
            margin: 0;
        }

        .el-submenu [class^=el-icon-] {
            font-size: 16px;
        }

        .el-menu-item [class^=el-icon-] {
            font-size: 16px;
        }

        .el-submenu__title:focus,
        .el-submenu__title:hover,
        .el-menu-item:focus,
        .el-menu-item:hover {
            background-color: rgba(116, 14, 24, .3) !important;
        }

        .el-menu-item.is-active {
            background-color: rgba(116, 14, 24, .3) !important;
        }

        .el-menu-vertical-demo:not(.el-menu--collapse) {
            width: 240px;
            min-height: 400px;
        }

        .el-container .el-main {
            padding: 0;
            position: relative;
        }

        .el-container .el-main .tabs {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
        }

        .el-container .el-main .el-tabs--border-card {
            background: transparent;
            border: 0;
            height: 100%;
        }

        .el-container .el-main .el-tabs--border-card>.el-tabs__header {
            background: #fff;
            padding-top: 0;
            border-bottom: 1px solid #e5e5e5;
        }

        .el-container .el-main .el-tabs--border-card>.el-tabs__header .el-tabs__item:not(.is-disabled):hover {
            background: #acb0b3;
            border-right-color: #acb0b3;
            border-left-color: #acb0b3;
            color: #fff;
        }

        .el-container .el-main .el-tabs--border-card>.el-tabs__header .el-tabs__item.is-active {
            background: #acb0b3;
            border-right-color: #acb0b3;
            border-left-color: #acb0b3;
            color: #fff;
            margin-top: 0;
        }



        .el-container .el-main .el-tabs__content {
            height: calc(100% - 25px);
            padding: 0;
            background: #e7eded;
        }

        .el-container .el-main .frame {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 100%;
            overflow: hidden;
        }

        .el-container .el-footer {
            height: 26px !important;
            line-height: 26px;
            text-align: center;
            background: #000000;
            color: #808080;
        }

        .el-container .el-header .el-tabs__item {
            height: 36px;
            line-height: 36px;
        }

        .el-container .el-main .el-tabs__item {
            height: 24px;
            line-height: 24px;
        }

        .el-container .el-header .el-badge {
            line-height: normal;
        }

        .el-badge__content {
            background-color: #fff;
            color: #b91727;
            top: 4px;
            right: 12px;
            padding: 0 8px;
        }

        .el-popover__title {
            font-size: 12px;
            margin: 0;
            padding-bottom: 6px;
            padding-left: 5px;
            border-bottom: 1px solid #e5e5e5;
        }

        .bell {
            font-size: 12px;
            padding: 4px 0;
            border-bottom: 1px solid #e5e5e5;
            cursor: pointer;
        }

        .bell:hover {
            background: #fafafa;
        }

        .bell .bell-content {
            text-overflow: -o-ellipsis-lastline;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            color: #000;
            padding: 0 5px;
        }

        .bell .bell-date {
            text-align: right;
            padding: 0 5px;
        }

        .el-popover {
            padding: 12px 0 0 0;
        }
    </style>
</head>

<body>
    <div id="app">

        <el-popover ref="popover1" placement="top-start" title="标题" width="200" trigger="hover"
            content="这是一段内容,这是一段内容,这是一段内容,这是一段内容。">
        </el-popover>

        <el-container v-cloak>
            <el-header>
                <div class="top-drag"></div>
                <div class="row-1">
                    <div class="logo">
                        <img src="image/logo.png" />
                        <span>福路德信息化平台</span>
                    </div>
                    <div class="system-operation">
                        <el-popover title="最新消息" placement="bottom" width="250" trigger="hover">
                            <div style="overflow-y:auto;max-height:300px;">
                                <div class="bell">
                                    <div class="bell-content">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                                    <div class="bell-date">2019-01-01</div>
                                </div>
                                <div class="bell">
                                    <div class="bell-content">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                                    <div class="bell-date">2019-01-01</div>
                                </div>
                                <div class="bell">
                                    <div class="bell-content">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                                    <div class="bell-date">2019-01-01</div>
                                </div>
                                <div class="bell">
                                    <div class="bell-content">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                                    <div class="bell-date">2019-01-01</div>
                                </div>
                                <div class="bell">
                                    <div class="bell-content">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                                    <div class="bell-date">2019-01-01</div>
                                </div>
                                <div class="bell">
                                    <div class="bell-content">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                                    <div class="bell-date">2019-01-01</div>
                                </div>
                                <div class="bell">
                                    <div class="bell-content">测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试测试</div>
                                    <div class="bell-date">2019-01-01</div>
                                </div>
                            </div>
                            <div slot="reference" class="item">
                                <el-badge value="8" :max="99">
                                    <i class="el-icon-bell" style="font-size: 22px;"></i>
                                </el-badge>
                            </div>


                        </el-popover>

                        <div class="item">
                            <span>金俊杰</span>
                            <i class="el-icon-arrow-down"></i>
                        </div>
                        <div class="item img">
                            <img src="image/header.png" />
                        </div>
                        <div class="item" @click="min">
                            <i class="iconfont icon-suoxiao1"></i>
                        </div>
                        <div class="item" @click="toggleWinSize">
                            <i class="iconfont icon-suoxiao" style="font-size:14px;"></i>
                        </div>
                        <div class="item" @click="close">
                            <i class="iconfont icon-close" style="font-size:20px;"></i>
                        </div>
                    </div>
                </div>
                <div class="row-2">
                    <el-tabs class="tabs-padding" type="border-card" v-model="categoryActive"
                        @tab-click="categoryToggle">
                        <el-tab-pane v-for="(row,index) in categoryList" :name="row.Id + '_' + row.Name">
                            <span slot="label"><i class="iconfont" :class="row.ImageUrl"
                                    style="margin-right:10px;font-size:14px;"></i>{{row.Name}} </span>
                        </el-tab-pane>
                    </el-tabs>
                    <!-- <div class="calendar"></div> -->
                </div>
                <div class="row-3">
                    <div style="float:left;">
                        <div class="tree-search">
                            <el-button type="text" icon="el-icon-menu" @click="toggleTree"></el-button>
                            <el-button type="text" icon="el-icon-d-caret" v-show="showIcon" @click="toggleOpen">伸缩
                            </el-button>
                            <div class="search-text" v-show="showIcon">
                                <input type="text" v-model="searchKey" />
                                <el-button type="text" icon="el-icon-search" @click="searchMenu"></el-button>
                            </div>
                        </div>
                    </div>
                    <el-button-group>
                        <el-button type="primary">刷新页签</el-button>
                        <el-button type="primary">关闭当前页签</el-button>
                        <el-button type="primary">关闭所有页签</el-button>
                        <el-button type="primary">关闭其他页签</el-button>
                    </el-button-group>

                </div>
            </el-header>
            <el-container>
                <el-aside>

                    <div class="tree-list">
                        <!-- <el-menu background-color="transparent" text-color="#fff" active-text-color="#fff"
                            :collapse="isCollapse" class="el-menu-vertical-demo">

                            <menu-template :menu_data="nodeList" @item-click="treeSelect"></menu-template>

                        </el-menu> -->
                        <menu-template :collapse="isCollapse" :openeds="openeds" :menu_data="nodeList"
                            @item-click="treeSelect"></menu-template>
                    </div>
                </el-aside>
                <el-container>
                    <el-main>
                        <div class="tabs">
                            <el-tabs type="border-card" v-model="rightTabsActive" @tab-remove="rightTabsRemove" @tab-click="openDevTools" @tab-add="openDevTools">
                                <el-tab-pane label="首页" name="首页">
                                    <div class="frame">
                                        <webview src="http://47.110.58.236:9981/TreeFormList/Table?moduleName=仓库树列表"
                                            style="width:100%;height:100%"></webview>
                                    </div>
                                </el-tab-pane>
                                <el-tab-pane closable v-for="(row,index) in rightTabsList" :label="row.Name"
                                    :name="row.Id + '_' + row.Name">
                                    <div class="frame">
                                        <webview :src="row.NavigateUrl" style="width:100%;height:100%"></webview>
                                    </div>
                                </el-tab-pane>
                            </el-tabs>
                        </div>
                    </el-main>
                    <el-footer>福路德</el-footer>
                </el-container>
            </el-container>
        </el-container>
    </div>

    
</body>
<script>
    const { ipcRenderer } = require('electron')
    const { SystemModules, SelfModules } = require(ipcRenderer.sendSync('getRootPath') + '/assembly/RequireHelper')
    const { post } = SelfModules('httpHelper')
    const Config = require(ipcRenderer.sendSync('getRootPath') + '/config/config.json')

    let winSizeType = 1;

    // setTimeout(() => {
    //     document.querySelector('webview').getWebContents().openDevTools()
    // }, 2000)


    Vue.prototype.$ELEMENT = { size: 'mini' }

    Vue.component('menu-template-sub', {
        props: ['menu_data'],
        template: '<div>' +
            '<div v-for="(row,index) in menu_data">' +
            '<el-submenu v-if="row.node.length" :index="\'self\' + row.Id">' +
            '<span slot="title">{{row.Name}}</span>' +
            '<menu-template-sub :menu_data="row.node" @sub-item-click="menuItemClick"></menu-template-sub>' +
            '</el-submenu>' +
            '<el-menu-item v-else :index="\'self\' + row.Id" @click="menuItemClick(row)">{{row.Name}}</el-menu-item>' +
            '</div>' +
            '</div>',
        methods: {
            menuItemClick(row) {
                this.$emit('sub-item-click', row);
            }
        }

    })
    Vue.component('menu-template', {
        props: ['menu_data', 'collapse', 'openeds'],
        template: '<el-menu background-color="transparent" text-color="#fff" active-text-color="#fff" :collapse="collapse" :default-openeds="openeds" class="el-menu-vertical-demo">' +
            '<el-submenu v-for="(row,index) in menu_data" v-if="row.node.length" :index="\'self\' + row.Id">' +
            '<template slot="title"><i class="iconfont" :class="row.ImageUrl" style="margin-right:10px;font-size:16px;"></i><span slot="title">{{row.Name}}</span></template>' +
            '<menu-template-sub :menu_data="row.node" class="bg-opacity" @sub-item-click="menuItemClick" ></menu-template-sub>' +
            '</el-submenu>' +
            '<el-menu-item v-else :index="\'self\' + row.Id" @click="menuItemClick(row)">' +
            '<i class="iconfont" :class="row.ImageUrl" style="margin-right:10px;font-size:16px;"></i>' +
            '<span slot="title">{{row.Name}}</span>' +
            '</el-menu-item>' +
            '</el-menu>',
        methods: {
            menuItemClick(row) {
                this.$emit('item-click', row);
            }
        }

    })

    const vm = new Vue({
        el: '#app',
        data: {
            showIcon: true,
            isCollapse: false,
            openeds: [],
            totalList: [],
            originTotalList: [],
            categoryList: [],
            categoryActive: '',
            nodeList: [],
            rightTabsList: [],
            rightTabsActive: '首页',
            searchKey: '',
            currentTypeId: 0
        },
        created: function () {
            var that = this;

            post({
                path: '/Frame/SqlData'
            }, {
                    cmdname: 'getMainMenu'
                }, (ret) => {
                    let data = JSON.parse(ret);
                    if (data.status == 200) {
                        let that = this;
                        let totalList = data.data.ds
                        for (let i in totalList) {
                            if (totalList[i].NavigateUrl) {
                                totalList[i].NavigateUrl = 'http://' + Config.Http_config.ip + ':' + Config.Http_config.port + totalList[i].NavigateUrl;
                            }
                        }
                        that.totalList = totalList;
                        for (let i in that.totalList) {
                            if (that.totalList[i].ParentID == 1) {
                                that.categoryList.push(that.totalList[i]);
                            }
                        }
                        that.originTotalList = JSON.parse(JSON.stringify(that.totalList));
                        if (that.categoryList.length > 0) {
                            that.categoryActive = that.categoryList[0].Id + '_' + that.categoryList[0].Name;
                            that.currentTypeId = that.categoryList[0].Id;
                            that.setSubClass(that.categoryList[0].Id);
                        }


                    } else {
                        layer.msg('接口数据异常!请稍后再试');
                    }
                }, (err) => {

                })

        },
        methods: {
            openDevTools(e){
                $(e.$el).find('webview')[0].getWebContents().openDevTools();
                $(e.$el).find('webview')[0].reloadIgnoringCache();
            },
            setSubClass(id) {
                let that = this;
                that.nodeList = [];
                that.openeds = [];
                if (that.searchKey == '') {
                    let repeatNode = (id) => {
                        let node = [];
                        for (let i in that.totalList) {
                            if (id == that.totalList[i].ParentID) {
                                that.totalList[i].node = repeatNode(that.totalList[i].Id);
                                node.push(that.totalList[i]);
                            }
                        }
                        return node;
                    }
                    that.nodeList = repeatNode(id);
                }
                else {
                    let node = [];
                    for (let i in that.originTotalList) {
                        if (that.originTotalList[i].Name.indexOf(that.searchKey) >= 0) {
                            that.originTotalList[i].node = [];
                            var isLeaf = true;
                            for (let j in that.originTotalList) {
                                if (that.originTotalList[j].ParentID == that.originTotalList[i].Id) {
                                    isLeaf = false;
                                    break;
                                }
                            }
                            if (isLeaf) {
                                node.push(that.originTotalList[i]);
                            }


                        }
                    }
                    that.nodeList = node;
                }

                for (let i in that.nodeList) {
                    that.openeds.push('self' + that.nodeList[i].Id);
                }
            },
            treeSelect(row) {
                let that = this;
                let x = 0;
                for (let i in that.rightTabsList) {
                    if (that.rightTabsList[i].Id == row.Id) {
                        x = 1;
                        that.rightTabsActive = row.Id + '_' + row.Name;
                    }
                }
                if (x == 0) {
                    that.rightTabsList.push(row);
                    that.rightTabsActive = row.Id + '_' + row.Name;
                }
            },
            toggleOpen() {
                let that = this;
                if (!that.openeds.length) {
                    that.openeds = [];
                    for (let i in that.nodeList) {
                        that.openeds.push('self' + that.nodeList[i].Id);
                    }
                } else {
                    that.openeds = [];
                }
            },
            rightTabsRemove(targetName) {
                let tabs = this.rightTabsList;
                let activeName = this.rightTabsActive;
                if (activeName === targetName) {
                    tabs.forEach((tab, index) => {
                        if ((tab.Id + '_' + tab.Name) === targetName) {
                            let nextTab = tabs[index + 1] || tabs[index - 1];
                            if (nextTab) {
                                activeName = nextTab.name;
                            } else {
                                activeName = '首页'
                            }
                        }
                    });
                }

                this.rightTabsActive = activeName;
                this.rightTabsList = tabs.filter(tab => (tab.Id + '_' + tab.Name) !== targetName);
            },
            //大类切换
            categoryToggle(e) {
                var that = this;
                that.searchKey = "";
                let name = e.name;
                let id = parseInt(name.split('_')[0]);
                that.currentTypeId = id;
                that.setSubClass(id)
            },
            //小类搜索
            searchMenu() {
                var that = this;
                that.setSubClass(that.currentTypeId);
            },
            min() {
                ipcRenderer.send('minWindow');
            },
            toggleWinSize(){
                if(winSizeType == 1){
                    winSizeType = 0;
                    ipcRenderer.send('toggleWindow_min');
                }else{
                    winSizeType = 1;
                    ipcRenderer.send('toggleWindow_max');
                }
            },
            close() {
                layer.confirm('确定退出吗?', {
                    btn: ['确认', '取消'] //按钮
                }, () => {
                    ipcRenderer.sendSync('quitApp');
                }, () => {
                    layer.closeAll()
                });

            },
            toggleTree() {
                let that = this;
                that.showIcon = !that.showIcon;
                setTimeout(() => {
                    that.isCollapse = !that.showIcon;
                }, 100)
            }
        }
    })
</script>

</html>